import {
Entity,
Column,
PrimaryColumn,
ManyToOne,
OneToOne,
JoinColumn,
Index,
Unique,
} from 'typeorm';
{{#if importsTS}}
  import { {{join importsTS ", "}} } from './index';
{{/if}}

{{!-- UNIQUE CONSTRAINTS (from constraints.unique) --}}
{{#if constraints.unique}}
  {{#each constraints.unique}}
    @Unique('{{constraintName}}', [
    {{#each columnNamesTS}}
      '{{this}}'{{#unless @last}}, {{/unless}}
    {{/each}}
    ])
  {{/each}}
{{/if}}

{{!-- NORMAL INDEXES (non-unique) --}}
{{#if indexes}}
  {{#each indexes}}
    {{#unless isUnique}}
      @Index('{{indexName}}', [
      {{#each columnNamesTS}}
        '{{this}}'{{#unless @last}}, {{/unless}}
      {{/each}}
      ])
    {{/unless}}
  {{/each}}
{{/if}}

@Entity({ name: '{{tableName}}', schema: '{{owner}}' })
export class {{tableNameTS}}Entity {

{{!-- COLUMNS --}}
{{#each columns}}
  {{#if isPrimary}}
  @PrimaryColumn({
  {{else}}
  @Column({
  {{/if}}
  name: '{{columnName}}',
  {{#if dataType}}
    type: '{{dataType}}',
  {{/if}}
  {{#if supportsLength}}
  {{#if dataLength}}
    length: {{dataLength}},
  {{/if}}
  {{/if}}
  {{#if supportsPrecision}}
  {{#if dataPrecision}}
    precision: {{dataPrecision}},
  {{/if}}
  {{/if}}
 {{#if supportsScale}}
  {{#if dataScale}}
    scale: {{dataScale}},
  {{/if}}
  {{/if}}
  {{#if dataDefault}}
    default: {{{dataDefault}}},
  {{/if}}
  {{#if comment}}
    comment: "{{comment}}",
  {{/if}}
  {{#if nullable}}
    nullable: true,
  {{/if}}
  })
  {{columnNameTS}}: {{dataTypeTS}}{{#if nullable}} | null{{/if}};

{{/each}}

{{!-- RELATIONS --}}
{{#if constraints.foreign}}
  {{#each constraints.foreign}}
    @{{#if (equal relationTypeTS "one-to-one")}}OneToOne{{else}}ManyToOne{{/if}}(
    () => {{columns.[0].referencedTableNameTS}}Entity
    )
    @JoinColumn([
    {{#each columns}}
      { name: '{{columnName}}', referencedColumnName: '{{referencedColumnNameTS}}' }{{#unless @last}},{{/unless}}
    {{/each}}
    ])
    {{relationNameTS}}: {{columns.[0].referencedTableNameTS}}Entity;

  {{/each}}
{{/if}}

}
